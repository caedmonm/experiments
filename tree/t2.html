<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <title></title>
      <style media="screen">
         html,body{
            padding:0;
            margin:0;
            overflow: hidden;
         }
      </style>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" />
   </head>
   <body>
   </body>
   <script type="text/javascript">
   var startTrunkWidth;
   var cW = $(document).width();
   var cH = $(document).height();
   var fillCol = "rgb(0,0,0)";
   var trees = [];
   var treeCount = 3;
   var startWidth = 12;
   var startLength = 100;
   var decay_length = 5;
   var decay_width = 1;

   function createTrees(){
      for (var i = 0; i < treeCount; i++) {
         trees.push({
            nodes: [
               {
                  x: Math.round((cW/treeCount)*i),
                  // x: cW/2,
                  y: cH,
                  width: startWidth,
                  length: Math.round(startLength - (Math.random()*(startLength/10))),
                  parent: -1,
                  branches: 1, // number of branches should be 1 at start, then 2,
                  sprouted: 1
               },
               {
                  x: Math.round((cW/treeCount)*i),
                  // x: cW/2,
                  y: cH,
                  width: startWidth,
                  length: Math.round(startLength - (Math.random()*(startLength/10))),
                  parent: 0,
                  branches: 1, // number of branches should be 1 at start, then 2,
                  sprouted: 0
               }
            ]
         });
      }
   }

   function addNode(i){
      var t = trees[i];
      var l = t.nodes.length
      for (var j = 0; j < l; j++) {
         var n = t.nodes[j]; // this node.
         if(n.length && n.width){
            while(n.sprouted < n.branches){
               t.nodes.push({
                  x: Math.round((n.x + Math.random()*n.length - Math.random()*n.length)),
                  y: Math.round((n.y - Math.random()*n.length)),
                  length: n.length - decay_length,
                  width: n.width - decay_width,
                  parent: j,
                  branches: 2,
                  sprouted: 0
               })
               n.sprouted++;
            }
         }
      }
   }

   function drawTree(i){
      var t = trees[i];
      for (var i = 0; i < t.nodes.length; i++) {
         var n = t.nodes[i];
         if(n.parent>-1){
            line(n.x, n.y, t.nodes[n.parent].x, t.nodes[n.parent].y);
            strokeWeight(n.width);
            // stroke(Math.round(Math.random()*255), 204, 0);
            // var x1 = n.x;
            // var y1 = n.y;
            // var x2 = t.nodes[n.parent].x;
            // var y2 = t.nodes[n.parent].y;
            // bezier(
            //    x1, // start x
            //    y2, // start y
            //    x1, // cp 1 x
            //    y1, // cp 1 y
            //    x2, // cp 2 x
            //    y2, // cp 2 y
            //    x2, // end x
            //    y2  // end y
            // );

         }
      }
   }


   function setup() {
      createTrees();
      frameRate(6);
      createCanvas(cW, cH);
   }

   function draw(){
      clear();
      for (var i = 0; i < trees.length; i++) {
         addNode(i);
         drawTree(i);
      }
   }
   </script>
</html>
